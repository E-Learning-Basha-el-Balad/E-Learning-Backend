<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Announcements</title>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        let socket;

        window.onload = function() {
            socket = io('/ws/announcement');

            socket.on('connect', () => {
                console.log('Connected to WebSocket server');
            });

            socket.on('announcement:created', (announcement) => {
                console.log('New announcement created:', announcement);
            });

            socket.on('announcement:create:error', (error) => {
                console.error('Error creating announcement:', error);
            });

            socket.on('room:joined:course', (data) => {
                console.log(data.message);
            });

            socket.on('room:join:course:error', (error) => {
                console.error('Error joining course room:', error);
            });

            socket.on('room:left:course', (data) => {
                console.log(data.message);
            });

            socket.on('room:leave:course:error', (error) => {
                console.error('Error leaving course room:', error);
            });
        };

        // Function to join a course room
        function joinRoom() {
            const courseId = document.getElementById('courseId').value;
            if (courseId) {
                socket.emit('room:join:course', { id: courseId });
            } else {
                alert('Please enter a course ID.');
            }
        }

        // Function to leave a course room
        function leaveRoom() {
            const courseId = document.getElementById('courseId').value;
            if (courseId) {
                socket.emit('room:leave:course', { id: courseId });
            } else {
                alert('Please enter a course ID.');
            }
        }

        // Function to create an announcement
        function createAnnouncement() {
            const contentText = document.getElementById('announcementContent').value;
            const courseId = document.getElementById('courseIdForAnnouncement').value;
            const instructorId = document.getElementById('instructorId').value;

            if (contentText && courseId && instructorId) {
                const announcement = {
                    content: contentText,
                    instructor: instructorId,
                    course: courseId
                };

                socket.emit('announcement:create', announcement);
                document.getElementById('announcementContent').value = ''; // Clear textarea
                document.getElementById('instructorId').value = ''; // Clear instructor ID
                document.getElementById('courseIdForAnnouncement').value = ''; // Clear course ID
            } else {
                alert('Please enter content, instructor ID, and course ID.');
            }
        }
    </script>
</head>
<body>
    <h1>Announcements</h1>

    <div>
        <h2>Join Course Room</h2>
        <input type="text" id="courseId" placeholder="Course ID">
        <button onclick="joinRoom()">Join Room</button>
    </div>

    <div>
        <h2>Leave Course Room</h2>
        <input type="text" id="courseId" placeholder="Course ID">
        <button onclick="leaveRoom()">Leave Room</button>
    </div>

    <div>
        <h2>Create Announcement</h2>
        <textarea id="announcementContent" placeholder="Announcement Content"></textarea>
        <input type="text" id="courseIdForAnnouncement" placeholder="Course ID">
        <input type="text" id="instructorId" placeholder="Instructor ID">
        <button onclick="createAnnouncement()">Create Announcement</button>
    </div>
</body>
</html>